Google Apps Grouper Provisioner
==============================

This project is a [Grouper](http://grouper.internet2.edu/) provisioner that provisions (and deprovisions) Grouper groups and subjects to Google Apps for Education/Business. 

Unicon's work on the Google Apps Grouper Provisioner project is funded through a project with Oregon State University. It is intended that the products (source code and deliverables) of this project will be donated to the Grouper project, and that rights will be assigned to Internet2.

## Installation
1. Download or clone the source repository from https://github.com/Unicon/googleapps-grouper-provisioner.

1. Build the module and pull down dependencies by running `mvn clean mvn dependency:copy-dependencies package -DskipTests -DincludeScope=runtime`.

   This will download all of the transitive dependencies and place them in `target/dependencies`, and build the provisioner module at `target/target/google-apps-provisioner-1.0-SNAPSHOT.jar`. 

## Basic Configuration
Settings for the Google Apps Grouper Provisioner are stored in the `grouper-loader.properties' file.

At a minimum the following must be added and set:

```
changeLog.consumer.google.serviceAccountPKCS12FilePath = <path to the PKCS12 key file generated by Google>
changeLog.consumer.google.serviceAccountEmail = <service account email address generated by Google>

changeLog.consumer.google.serviceImpersonationUser = <an existing Google account that will be used to make the Google Group changes>
changeLog.consumer.google.domain=<the email domain of the Google accounts and groups>

changeLog.consumer.google.groupIdentifierExpression=${groupName}
changeLog.consumer.google.subjectIdentifierExpression=${subjectId}
```

The first items are created by following the instructions at [Perform Google Apps Domain-Wide Delegation of Authority](https://developers.google.com/admin-sdk/directory/v1/guides/delegation).
The account will need to be given these grants: `https://www.googleapis.com/auth/admin.directory.user, https://www.googleapis.com/auth/admin.directory.group`.

The serviceImpersonationUser is a fully qualified Google user account that the Google Apps Grouper Provisioner will be 
acting on behalf of, while the domain is the hostname of the user & google accounts.
 
The identiferExpressions can be used to manipulate the Google Group names and Google account names that will be provisioned. The 
properties are Java Expression Language (JEXL) patterns. ${groupName} is the full path of the group (e.ge qsob:courses:ACCT251:01).
${subjectId} is the subjectName coming from the subjects source. A sample JEXL string to pre-pend the group with "grp" and 
strip the first part of the stem would be `grp-${groupName.replace("qsob:courses", "")}`.  Colons are not permitted in the 
group name and will be replaced by a hyphen (-) if not replaced with something else (i.e. `.replace(":","_")`).

## Running
1. Add the module and dependencies to the CLASSPATH:

   On Linux: `export CLASSPATH=<PROJECT_HOME>/target/google-apps-provisioner-1.0-SNAPSHOT.jar:<PROJECT_HOME>/target/dependency/*`
   On Windows: `set CLASSPATH=<PROJECT_HOME>/target/google-apps-provisioner-1.0-SNAPSHOT.jar;<PROJECT_HOME>/target/dependency/*`
    
1. Start the Grouper Shell with the loader option: `gsh -loader`

## Marking Stems and Groups for Sync

## Acknowledgements
These individuals have provided guidance through out the development process:

* Andy Morgan, Oregon State University 
* Erica Lomax, Oregon State University
* David Langenberg, University of Chicago
* Chris Hyzer, University of Pennsylvania
* Jeff Pasch, New York University
* Gary Chapman, New York University
* Madan Dorairaj, New York University

